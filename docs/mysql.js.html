<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: mysql.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: mysql.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 *  Helper class for MySQL
 *  @module classes/mysql
 */

var mysqllib = require('mysql');
var log = require('./log.js');
var queries = [
    "CREATE TABLE IF NOT EXISTS `Users` (username PRIMARYKEY VARCHAR(22), password VARCHAR(128), rang ENUM(\'Viewer\', \'Dev\', \'Admin\'), twofa VARCHAR(16) NOT NULL, backupcode INT(20) NOT NULL)", //Password = SHA 512
    "CREATE TABLE IF NOT EXISTS `Daemons` (daemonname PRIMARYKEY VARCHAR(22), daemonip VARCHAR(16), minport INT(5), maxport INT(5), apikey VARCHAR(16))",
    "CREATE TABLE IF NOT EXISTS `Plugins` (pluginname PRIMARYKEY VARCHAR(32), version VARCHAR(100), size VARCHAR(8), hash VARCHAR(40))", //32 Chars should be enough
    "CREATE TABLE IF NOT EXISTS `Servertypes` (name PRIMARYKEY VARCHAR(22), plugins TEXT, worlds TEXT, minfree INT(5), csc TEXT)",
    "CREATE TABLE IF NOT EXISTS `Worlds` (worldname PRIMARYKEY VARCHAR(32), foldername TEXT, size VARCHAR(8), hash VARCHAR(40))"
];

module.exports = MySQL;

/**
 * Creates a mysql instance
 * @param host The mysql host
 * @param username The username
 * @param password The password
 * @param database The database
 * @param poolSize The size of the pool
 */
function MySQL(host, username, password, database, poolSize) {
    this.host = host;
    this.username = username;
    this.password = password;
    this.database = database;
    this.poolSize = poolSize;
}

/**
 * Connects to the database
 */
MySQL.prototype.connect = function() {
    this.db = mysqllib.createPool({
        connectionLimit: this.poolSize,
        host: this.host,
        user: this.user,
        password: this.password,
        database: this.database
    });
    this.db.getConnection(function(error) {
       if(error) {
           throw new SQLException(error);
       }
    });
    queries.forEach(function(query){
        this.db.query(query, function(err){
            if(err){log.error(err)}
        });
    })
};

/**
 * Executes a query to the database
 * @param query The query
 * @param cb The callback
 */
MySQL.prototype.query = function(query, cb) {
    this.db.query(query, function(err, rows) {
        if(err) {
            log.error(err);
        }
        if(cb){cb(rows);}
    });
};

/**
 * Adds a Query to the startqueries
 * @param query Startquery
 */
MySQL.prototype.addStartQuery = function(query) {
    queries.push(query);
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-classes_cloudlistener.html">classes/cloudlistener</a></li><li><a href="module-classes_config.html">classes/config</a></li><li><a href="module-classes_database_daemon.html">classes/database/daemon</a></li><li><a href="module-classes_database_plugin.html">classes/database/plugin</a></li><li><a href="module-classes_database_servertype.html">classes/database/servertype</a></li><li><a href="module-classes_database_user.html">classes/database/user</a></li><li><a href="module-classes_database_world.html">classes/database/world</a></li><li><a href="module-classes_loader.html">classes/loader</a></li><li><a href="module-classes_log.html">classes/log</a></li><li><a href="module-classes_mysql.html">classes/mysql</a></li><li><a href="module-classes_webserver.html">classes/webserver</a></li></ul><h3>Classes</h3><ul><li><a href="module-classes_database_daemon-Daemon.html">Daemon</a></li><li><a href="module-classes_database_plugin-Plugin.html">Plugin</a></li><li><a href="module-classes_database_servertype-Servertype.html">Servertype</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Wed Nov 18 2015 17:51:49 GMT+0100 (Mitteleurop√§ische Zeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
